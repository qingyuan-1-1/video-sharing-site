<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šä¼ è§†é¢‘ - è§†é¢‘åˆ†äº«å¹³å°</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ¬ è§†é¢‘åˆ†äº«å¹³å°</h1>
            <nav>
                <a href="index.html">é¦–é¡µ</a>
                <a href="upload.html" class="nav-active">ä¸Šä¼ è§†é¢‘</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="upload-section">
            <h2>ğŸ“¹ ä¸Šä¼ æ–°è§†é¢‘</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="videoTitle">è§†é¢‘æ ‡é¢˜ *</label>
                    <input type="text" id="videoTitle" name="title" required placeholder="ç»™ä½ çš„è§†é¢‘èµ·ä¸ªå¥½åå­—">
                </div>
                
                <div class="form-group">
                    <label for="videoDescription">è§†é¢‘æè¿°</label>
                    <textarea id="videoDescription" name="description" rows="4" placeholder="æè¿°ä¸€ä¸‹ä½ çš„è§†é¢‘å†…å®¹..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="videoFile">é€‰æ‹©è§†é¢‘æ–‡ä»¶ *</label>
                    <div class="file-input-container">
                        <input type="file" id="videoFile" name="video" accept="video/*" required>
                        <div class="file-input-text">
                            <span id="fileText">ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶</span>
                            <small>æ”¯æŒ: MP4, AVI, MOV, WMV (æœ€å¤§50MB)</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" id="uploadBtn">
                        <span>ğŸ“¤ ä¸Šä¼ è§†é¢‘</span>
                    </button>
                </div>
            </form>
            
            <div id="uploadProgress" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p>ä¸Šä¼ ä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>
            
            <div id="uploadResult"></div>
        </div>
    </main>

    <script>
        const uploadForm = document.getElementById('uploadForm');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadResult = document.getElementById('uploadResult');
        const uploadBtn = document.getElementById('uploadBtn');
        const videoFile = document.getElementById('videoFile');
        const fileText = document.getElementById('fileText');

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        videoFile.addEventListener('change', function() {
            if (this.files[0]) {
                const file = this.files[0];
                const sizeInMB = (file.size / (1024 * 1024)).toFixed(1);
                fileText.textContent = `${file.name} (${sizeInMB}MB)`;
                
                if (file.size > 50 * 1024 * 1024) {
                    alert('æ–‡ä»¶å¤ªå¤§ï¼è¯·é€‰æ‹©å°äº50MBçš„è§†é¢‘æ–‡ä»¶ã€‚');
                    this.value = '';
                    fileText.textContent = 'ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶';
                }
            }
        });

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(uploadForm);
            
            // éªŒè¯
            if (!formData.get('video')) {
                alert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼');
                return;
            }
            
            if (!formData.get('title').trim()) {
                alert('è¯·è¾“å…¥è§†é¢‘æ ‡é¢˜ï¼');
                return;
            }
            
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<span>ä¸Šä¼ ä¸­...</span>';
            uploadProgress.style.display = 'block';
            uploadResult.innerHTML = '';
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    uploadResult.innerHTML = `
                        <div class="success-message">
                            <h3>âœ… ä¸Šä¼ æˆåŠŸ!</h3>
                            <p>è§†é¢‘ã€Š${result.video.title}ã€‹å·²æˆåŠŸä¸Šä¼ </p>
                            <div class="result-actions">
                                <button onclick="location.href='index.html'" class="btn-primary">æŸ¥çœ‹æ‰€æœ‰è§†é¢‘</button>
                                <button onclick="resetForm()" class="btn-secondary">ç»§ç»­ä¸Šä¼ </button>
                            </div>
                        </div>
                    `;
                } else {
                    uploadResult.innerHTML = `
                        <div class="error-message">
                            <h3>âŒ ä¸Šä¼ å¤±è´¥</h3>
                            <p>${result.error || 'æœªçŸ¥é”™è¯¯'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('ä¸Šä¼ é”™è¯¯:', error);
                uploadResult.innerHTML = `
                    <div class="error-message">
                        <h3>âŒ ä¸Šä¼ å¤±è´¥</h3>
                        <p>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</p>
                    </div>
                `;
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<span>ğŸ“¤ ä¸Šä¼ è§†é¢‘</span>';
                uploadProgress.style.display = 'none';
            }
        });

        function resetForm() {
            uploadForm.reset();
            fileText.textContent = 'ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶';
            uploadResult.innerHTML = '';
        }
    </script>
</body>
</html>
